<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{{ html_title }}</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>

    <script type="text/javascript" charset="utf-8">
        $(document).ready(function () {
            var fp_path = "logs/celery.log";
            var namespace = "";
            var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);


            $(".dropdown").on("change", function (e) {
                var filepath = $('.dropdown').val();
                // getData(filepath, true);
                console.log(filepath)
                fp_path = filepath
                socket.emit('client', { 'fp_path': filepath });
                $("#terminal").html(""); // 切换清空显示区域


            });


            // socket.emit('client', {'fp_path': fp_path});

            socket.on('response', function (res) {
                console.log(res)
                if (res.path === fp_path) {
                    var top_info = res.text;
                    // var old = document.getElementById("terminal").innerHTML;
                    $("#terminal").append('<li>' + top_info + '</li>');
                }

            });

            $(window).bind('onbeforeunload', function () {    // 离开页面前关闭tail
                socket.emit('leavepage', { '_type': _type });

            }
            );
        });
    </script>
    <style type="text/css">

    </style>

</head>

<body>


    <div>

        <select name="files" class="dropdown" id="ddfiles" style="width:50%;">
            {% for key, value in data.items() %}
            <optgroup label="{{key}}">
                {% for res in value %}
                <option value="{{res.0}}">{{res.1}}</option>
                {% endfor %}
            </optgroup>
            {% endfor %}
        </select>

        <div id="terminal">

        </div>
    </div>

</body>


</html>